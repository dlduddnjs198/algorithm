import java.util.*;

/**
 * ğŸ“Œ KMP(Knuth-Morris-Pratt) ë¬¸ìì—´ ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜
 *
 * âœ… ì£¼ìš” ê°œë…:
 * - 'í…ìŠ¤íŠ¸'ì—ì„œ 'íŒ¨í„´'ì„ ë¹ ë¥´ê²Œ ì°¾ê¸° ìœ„í•œ ì•Œê³ ë¦¬ì¦˜
 * - ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì‹ì²˜ëŸ¼ ë§¤ë²ˆ ì²˜ìŒë¶€í„° ë¹„êµí•˜ì§€ ì•Šê³ , 'ì´ì „ì— ì¼ì¹˜í•œ ì •ë³´ë¥¼ í™œìš©'í•˜ì—¬ ì í”„í•¨
 * - ì´ë¥¼ ìœ„í•´ 'ë¶€ë¶„ ì¼ì¹˜ í…Œì´ë¸”(pi ë°°ì—´)'ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ ì‚¬ìš©
 *
 * âœ… í•µì‹¬ ë™ì‘:
 * 1. ë¨¼ì € íŒ¨í„´ì—ì„œ ì ‘ë‘ì‚¬ == ì ‘ë¯¸ì‚¬ì¸ ë¶€ë¶„ ê¸¸ì´ë¥¼ pi ë°°ì—´ë¡œ êµ¬í•œë‹¤
 *    ì˜ˆ: pattern = "ababab" â†’ pi = [0, 0, 1, 2, 3, 4]
 * 2. í…ìŠ¤íŠ¸ì—ì„œ ë¹„êµ ì¤‘ í‹€ë¦¬ë©´, íŒ¨í„´ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë¹„êµí•˜ì§€ ì•Šê³ 
 *    pi ë°°ì—´ì„ ì°¸ê³ í•´ 'íŒ¨í„´ ì¸ë±ìŠ¤ j'ë§Œ ì í”„
 *    â†’ iëŠ” ì ˆëŒ€ ë˜ëŒì•„ê°€ì§€ ì•ŠìŒ (iëŠ” í•­ìƒ í•œ ì¹¸ì”© ì¦ê°€)
 *
 * âœ… ì‹œê°„ë³µì¡ë„:
 * - pi ë°°ì—´ ìƒì„±: O(m) (m = íŒ¨í„´ ê¸¸ì´)
 * - í…ìŠ¤íŠ¸ ë¹„êµ: O(n) (n = í…ìŠ¤íŠ¸ ê¸¸ì´)
 * â†’ ì „ì²´ ì‹œê°„ë³µì¡ë„: O(n + m)
 *
 * âœ… ì˜ˆì‹œ:
 * text    = "abababxababab"
 * pattern = "ababab"
 * â†’ ê²°ê³¼: [0, 7]
 */
public class Main {

    public static void main(String[] args) {
        String text = "ababababxababab";
        String pattern = "ababab";

        List<Integer> positions = kmpSearch(text, pattern);
        System.out.println("íŒ¨í„´ì´ ë“±ì¥í•˜ëŠ” ìœ„ì¹˜: " + positions);
    }

    /**
     * ì£¼ì–´ì§„ í…ìŠ¤íŠ¸(text)ì—ì„œ íŒ¨í„´(pattern)ì´ ë“±ì¥í•˜ëŠ” ëª¨ë“  ì‹œì‘ ì¸ë±ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
     * ì˜ˆ: text = "ababcababcac", pattern = "ababc"
     * â†’ [0, 5] ë°˜í™˜
     */
    private static List<Integer> kmpSearch(String text, String pattern){
        List<Integer> result = new ArrayList<>();
        int[] pi = buildPi(pattern); // ë¶€ë¶„ ì¼ì¹˜ í…Œì´ë¸” ë§Œë“¤ê¸°(ì „ì²˜ë¦¬)

        int j = 0; // í˜„ì¬ íŒ¨í„´ ë§¤ì¹­ ìœ„ì¹˜

        // iëŠ” ë°˜ë³µë¬¸ëŒ€ë¡œ í•˜ë‚˜í•˜ë‚˜ ì˜¬ë¼ê°€ê³ (ì„ì˜ë¡œ ì¡°ì •ë˜ì§€ ì•ŠëŠ”ë‹¤.), ì¡°ê±´ì— ë”°ë¼ íŒ¨í„´ ì¸ë±ìŠ¤ jë§Œ pië°°ì—´ì— ë”°ë¼ ì í”„í•œë‹¤.
        for(int i=0;i<text.length();i++){
            // ğŸ” ì¼ì¹˜ê°€ ëŠê¸°ë©´ pi ë°°ì—´ì„ ì‚¬ìš©í•´ ì í”„
            while (j > 0 && text.charAt(i) != pattern.charAt(j)) {
                j = pi[j - 1]; // ì´ì „ ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬ ê¸¸ì´ë¡œ ì í”„
            }

            // ë¬¸ì ì¼ì¹˜
            if (text.charAt(i) == pattern.charAt(j)) {
                j++;

                // íŒ¨í„´ ì „ì²´ê°€ ë§¤ì¹­ëœ ê²½ìš°
                if (j == pattern.length()) {
                    result.add(i - pattern.length() + 1); // ì‹œì‘ ìœ„ì¹˜ ì €ì¥
                    j = pi[j - 1]; // ë‹¤ìŒ ë§¤ì¹­ ìœ„í•´ jump
                }
            }
        }


    }

    /**
     * ë¶€ë¶„ ì¼ì¹˜ í…Œì´ë¸”(pi ë°°ì—´)ì„ ìƒì„±í•©ë‹ˆë‹¤.
     * pi[i]ëŠ” P[0..i]ì˜ ì ‘ë‘ì‚¬ == ì ‘ë¯¸ì‚¬ ì¤‘ ê°€ì¥ ê¸´ ê¸¸ì´ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
     */
    private static int[] buildPi(String pattern){
        int m = pattern.length();
        int[] pi = new int[m];
        int j = 0; // í˜„ì¬ê¹Œì§€ ì¼ì¹˜í•œ ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬ì˜ ê¸¸ì´
        for (int i = 1; i < m; i++) {
            // íŒ¨í„´ì˜ ì•ì—ì„œë¶€í„° jê°œì˜ ë¬¸ìê°€ ì¼ì¹˜í•´ì˜¤ê³  ìˆë‹¤ê³  ê°€ì •

            // ğŸ“Œ ì¼ì¹˜ê°€ ëŠê¸°ë©´, í˜„ì¬ jê¹Œì§€ì˜ ì¼ì¹˜ë¥¼ í¬ê¸°í•˜ê³ 
            // ë” ì§§ì€ ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬ë¡œ ì í”„í•´ì„œ ì´ì–´ê°ˆ ìˆ˜ ìˆëŠ”ì§€ í™•ì¸
            while (j > 0 && pattern.charAt(i) != pattern.charAt(j)) {
                j = pi[j - 1]; // ì ‘ë‘ì‚¬ ê¸¸ì´ ì¤„ì´ê¸°
            }

            // ë¬¸ì ì¼ì¹˜
            if (pattern.charAt(i) == pattern.charAt(j)) {
                j++;
                pi[i] = j; // ì§€ê¸ˆê¹Œì§€ ì¼ì¹˜í•œ ìµœëŒ€ ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬ ê¸¸ì´ ì €ì¥
            }
        }

        return pi;
    }
}